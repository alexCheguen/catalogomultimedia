<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Gestión de Géneros</title>
</h:head>

<h:body>
    <h:form id="genreForm">
        <p:growl id="messages" showDetail="true"/>

        <div class="card">
            <h2>Gestión de Géneros</h2>

            <!-- Barra de herramientas -->
            <p:toolbar>
                <p:toolbarGroup>
                    <p:commandButton value="Nuevo Género"
                                     icon="pi pi-plus"
                                     action="#{movieGenreBean.prepareNewGenre}"
                                     oncomplete="PF('dialogNewGenre').show()"
                                     update=":newGenreForm"
                                     styleClass="p-button-success"/>

                    <p:button value="Volver al Catálogo"
                              outcome="catalogo"
                              icon="pi pi-arrow-left"
                              styleClass="p-button-secondary"/>
                </p:toolbarGroup>
            </p:toolbar>

            <!-- Tabla de géneros -->
            <p:dataTable id="genreTable"
                         value="#{movieGenreBean.genres}"
                         var="genre"
                         paginator="true"
                         rows="15"
                         emptyMessage="No se encontraron géneros"
                         style="margin-top: 20px;">

                <p:column headerText="ID" style="width: 80px;">
                    <h:outputText value="#{genre.movieGenreId}"/>
                </p:column>

                <p:column headerText="Nombre del Género" sortBy="#{genre.genreName}">
                    <h:outputText value="#{genre.genreName}" style="font-weight: bold;"/>
                </p:column>

                <p:column headerText="Títulos Asociados" style="width: 150px; text-align: center;">
                    <p:badge value="#{genre.mediaTitles.size()}" severity="info"/>
                </p:column>

                <p:column headerText="Acciones" style="width: 150px; text-align: center;">
                    <p:commandButton icon="pi pi-pencil"
                                     title="Editar"
                                     action="#{movieGenreBean.prepareEdit(genre)}"
                                     oncomplete="PF('dialogEditGenre').show()"
                                     update=":editGenreForm"
                                     styleClass="p-button-warning p-button-sm"/>

                    <p:commandButton icon="pi pi-trash"
                                     title="Eliminar"
                                     action="#{movieGenreBean.deleteGenre(genre.movieGenreId)}"
                                     update="genreTable"
                                     styleClass="p-button-danger p-button-sm"
                                     style="margin-left: 5px;"
                                     disabled="#{genre.mediaTitles.size() > 0}">
                        <p:confirm header="Confirmación"
                                   message="¿Está seguro de eliminar este género?"
                                   icon="pi pi-exclamation-triangle"/>
                    </p:commandButton>
                </p:column>
            </p:dataTable>
        </div>

        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
            <p:commandButton value="Sí" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check"/>
            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times"/>
        </p:confirmDialog>
    </h:form>

    <!-- Diálogo: Nuevo Género -->
    <p:dialog id="dialogNewGenre" widgetVar="dialogNewGenre" header="Nuevo Género" modal="true" width="500">
        <h:form id="newGenreForm">
            <p:messages id="newGenreMessages"/>

            <div class="p-fluid">
                <div class="p-field">
                    <p:outputLabel for="genreName" value="Nombre del Género:"/>
                    <p:inputText id="genreName"
                                 value="#{movieGenreBean.newGenre.genreName}"
                                 required="true"
                                 maxlength="50"/>
                    <small>Mínimo 3 caracteres, máximo 50 caracteres</small>
                </div>
            </div>

            <p:commandButton value="Guardar"
                             icon="pi pi-save"
                             action="#{movieGenreBean.saveGenre}"
                             update=":genreForm:genreTable,:genreForm:messages,newGenreMessages"
                             oncomplete="if (args &amp;&amp; !args.validationFailed) PF('dialogNewGenre').hide()"
                             styleClass="p-button-success"/>

            <p:commandButton value="Cancelar"
                             icon="pi pi-times"
                             onclick="PF('dialogNewGenre').hide()"
                             styleClass="p-button-secondary"
                             type="button"
                             style="margin-left: 10px;"/>
        </h:form>
    </p:dialog>

    <!-- Diálogo: Editar Género -->
    <p:dialog id="dialogEditGenre" widgetVar="dialogEditGenre" header="Editar Género" modal="true" width="500">
        <h:form id="editGenreForm">
            <p:messages id="editGenreMessages"/>

            <div class="p-fluid">
                <div class="p-field">
                    <p:outputLabel for="editGenreName" value="Nombre del Género:"/>
                    <p:inputText id="editGenreName"
                                 value="#{movieGenreBean.selectedGenre.genreName}"
                                 required="true"
                                 maxlength="50"/>
                    <small>Mínimo 3 caracteres, máximo 50 caracteres</small>
                </div>
            </div>

            <p:commandButton value="Actualizar"
                             icon="pi pi-save"
                             action="#{movieGenreBean.updateGenre}"
                             update=":genreForm:genreTable,:genreForm:messages,editGenreMessages"
                             oncomplete="if (args &amp;&amp; !args.validationFailed) PF('dialogEditGenre').hide()"
                             styleClass="p-button-success"/>

            <p:commandButton value="Cancelar"
                             icon="pi pi-times"
                             onclick="PF('dialogEditGenre').hide()"
                             styleClass="p-button-secondary"
                             type="button"
                             style="margin-left: 10px;"/>
        </h:form>
    </p:dialog>
</h:body>
</html>